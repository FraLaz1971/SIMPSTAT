10 REM read csv file organised in lines (with CR LF terminator)
20 LET PN$="bCS.BAS":LET CF=0: LET D=2: LET T$=""
30 REM OPEN PROGRAM1 FILE (R)
40 F1 = OPENIN "SSTAT.BAS"
50 IF F1 = 0 THEN PRINT "problem in opening file SSTAT.BAS for reading": END
60 REM OPEN DATA FILE (R)
70 F2 = OPENIN "STATDATA.BAS"
80 IF F2 = 0 THEN PRINT "problem in opening file STATDATA.BAS for reading": END
90 REM OPEN TOT PROGRAM FILE (W)
100 F3 = OPENOUT "TSTAT.BAS"
110 IF F3 = 0 THEN PRINT "problem in opening file TSTAT.BAS for writing": END
120 F4 = OPENOUT "TS.LOG"
130 IF F4 = 0 THEN PRINT "problem in opening file TS.LOG for writing": END
140 LET N=1000
135 IF D=2 THEN M$="PROCESSING BEGIN":GOSUB 420
160 FOR L = 1 TO N
170 IF EOF# F1 THEN 250
190 T$=GET$#F1
210 BPUT#F3, T$
220 IF D=1 THEN M$="READ "+T$:GOSUB 420
240 NEXT L
250 IF D=2 THEN M$="END OF FILE "+"SSTAT.BAS":GOSUB 420
260 LET N=1000: LET T$=""
270 FOR L = 1 TO N
280 IF EOF# F2 THEN 350
300 T$=GET$#F2
310 BPUT#F3, T$
320 IF D=1 THEN M$="READ "+T$:GOSUB 420
340 NEXT L
350 IF D=2 THEN M$="END OF FILE "+"STATDATA.BAS":GOSUB 420
355 IF D=2 THEN M$="PROCESSING END":GOSUB 420
360 CLOSE# F1:CLOSE# F2:CLOSE# F3:CLOSE# F4
370 RUN "TSTAT.BAS"
380 END
390 REM FORMATTED MESSAGE ON TERMINAL
400 PRINT TIME$;"|";PN$;"|";M$
410 RETURN
420 REM FORMATTED MESSAGE ON LOG FILE
430 J$=TIME$+"|"+PN$+"|"+M$
440 BPUT#F4, J$
450 RETURN
